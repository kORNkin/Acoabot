<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ACOABOT - Automated Cocoa Garden Robot</title>
    <style>
        /* General Styling */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #F0F4F3;
        }
        header {
            background-color: #E8F5E9;
            padding: 20px;
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            color: #3C4858;
        }
        img {
            max-width: 100%;
            height: auto;
            width: auto\9; /* ie8 */
        }

        .content {
            display: flex;
            justify-content: space-between;
            padding: 20px;
        }
        .video-feed {
            flex: 2;
            margin-right: 20px;
        }
        .video-feed img {
            width: 100%;
            border-radius: 10px;
            border: 2px solid #3C4858;
        }
        .info-panel {
            flex: 1;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        .info-panel p {
            margin: 10px 0;
            font-size: 18px;
            color: #3C4858;
        }

        /* Control Panel Styling */
        .control-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
            margin-top: 30px;
        }
        .control-mode {
            flex: 1;
            text-align: center;
        }
        .control-mode button {
            padding: 10px 20px;
            border-radius: 20px;
            border: none;
            font-size: 16px;
            cursor: pointer;
            background-color: #B3E5FC;
            color: #3C4858;
            margin: 10px 0;
            display: block;
            width: 80%;
            margin-left: auto;
            margin-right: auto;
        }
        .control-mode button.active {
            background-color: #64B5F6;
            color: white;
        }
        .joystick-container {
            flex: 2;
            text-align: center;
        }
        .joystick {
            display: grid;
            grid-template-columns: 100px 100px 100px;
            grid-template-rows: 100px 100px 100px;
            justify-content: center;
            align-items: center;
            gap: 10px;
            position: relative;
        }
        .joystick button {
            background-color: #FFFFFF;
            border: 2px solid #3C4858;
            padding: 15px;
            border-radius: 50%;
            font-size: 30px;
            cursor: pointer;
            width: 100px;
            height: 100px;
        }
        .joystick .up {
            grid-column: 2;
            grid-row: 1;
        }
        .joystick .left {
            grid-column: 1;
            grid-row: 2;
        }
        .joystick .right {
            grid-column: 3;
            grid-row: 2;
        }
        .joystick .down {
            grid-column: 2;
            grid-row: 3;
        }
        .direction-buttons {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex: 1;
            margin: 0 20px;
            text-align: center;
        }
        .direction-buttons button {
            background-color: #FFFFFF;
            border: 2px solid #3C4858;
            padding: 15px;
            border-radius: 50%;
            font-size: 30px;
            cursor: pointer;
            width: 100px;
            height: 100px;
        }
        .direction-buttons .text {
            font-size: 14px;
            color: #3C4858;
            margin-bottom: 5px;
        }

        .stop-button {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex: 1;
            margin: 0 20px;
            text-align: center;
        }
        .stop-button button {
            background-color: #FFFFFF;
            border: 2px solid #3C4858;
            padding: 15px;
            border-radius: 50%;
            font-size: 30px;
            cursor: pointer;
            width: 100px;
            height: 100px;
        }
        .stop-button .text {
            font-size: 14px;
            color: #3C4858;
            margin-bottom: 5px;
        }

        .flash-button {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex: 1;
            margin: 0 20px;
            text-align: center;
        }
        .flash-button button {
            background-color: #FFFFFF;
            border: 2px solid #3C4858;
            padding: 15px;
            border-radius: 50%;
            font-size: 30px;
            cursor: pointer;
            width: 100px;
            height: 100px;
        }
        .flash-button .text {
            font-size: 14px;
            color: #3C4858;
            margin-bottom: 5px;
        }

        /* Auto Mode Panel */
        .auto-panel {
            display: none;
            flex-direction: column;
            flex: 2;
            text-align: left;
        }
        .auto-panel h4 {
            margin-bottom: 10px;
        }
        .auto-panel input {
            width: 100%;
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 5px;
            border: 1px solid #3C4858;
        }
        .auto-panel .input-positions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .waypoint-list {
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
            border: 1px solid #E0E0E0;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>
<body>
    <header>ACOABOT</header>
    <div class="content">
        <div class="video-feed" style="max-width:600px;">
            <h2>Farm View</h2>
            <img src="{{ url_for('webcam') }}" alt="Farm View">
        </div>
        <div class="info-panel">
            <h2>Information Panel</h2>
            <p><strong>GPS:</strong> <span id="gps-coordinates">8.368097, 100.043839</span></p>
            <p><strong>Amount of Infected plants:</strong> <span id="infected-count">5 plants</span></p>
            <p><strong>Blackpod:</strong> <span id="blackpod-count">2 plants</span></p>
            <p><strong>Frostypod:</strong> <span id="frostypod-count">1 plant</span></p>
            <p><strong>Mirid:</strong> <span id="mirid-count">2 plants</span></p>
        </div>
    </div>

    <div class="control-container">
        <div class="control-mode">
            <button id="manual-btn" class="active">Manual</button>
            <button id="auto-btn">Auto</button>
        </div>
        <div id="manual-controls" style="display: flex; width: 100%;">
            <div class="direction-buttons">
                <div>
                    <h4>Turn Left</h4>
                    <button onclick="sendCommand('q'); return false;">⤿</button>
                </div>
                <div>
                    <h4>Turn Right</h4>
                    <button onclick="sendCommand('e'); return false;">⤾</button>
                </div>
            </div>
            <div class="stop-button">
                <div>
                    <button onclick="sendCommand('h'); return false;">Stop</button>
                </div>
            </div>
            <div class="flash-button">
                <div>
                    <button onclick="sendCommand('f'); return false;">Flash</button>
                </div>
            </div>
            <div class="joystick-container">
                <div class="joystick">
                    <button class="up" onclick="sendCommand('w'); return false;">⬆️</button>
                    <button class="left" onclick="sendCommand('u'); return false;">⬅️</button>
                    <button class="right" onclick="sendCommand('o'); return false;">➡️</button>
                    <button class="down" onclick="sendCommand('s'); return false;">⬇️</button>
                </div>
            </div>
        </div>
        <div id="auto-controls" class="auto-panel">
            <h4>Home: <input type="text" id="home-position" placeholder="8.36, 100.04"></h4>
            <h4>New Waypoint:</h4>
            <input type="text" id="new-waypoint" placeholder="Enter a new waypoint">
            <button onclick="addWaypoint()">Add Waypoint</button>
            <div class="waypoint-list" id="waypoint-list"></div>
        </div>
    </div>

    <script>
        const gpsCoordinates = document.getElementById('gps-coordinates');
        const infectedCount = document.getElementById('infected-count');
        const blackpodCount = document.getElementById('blackpod-count');
        const frostypodCount = document.getElementById('frostypod-count');
        const miridCount = document.getElementById('mirid-count');
        const manualBtn = document.getElementById('manual-btn');
        const autoBtn = document.getElementById('auto-btn');
        const manualControls = document.getElementById('manual-controls');
        const autoControls = document.getElementById('auto-controls');
        const homePositionInput = document.getElementById('home-position');
        const newWaypointInput = document.getElementById('new-waypoint');
        const waypointList = document.getElementById('waypoint-list');
        
        

        function sendCommand(command) {
            var xhr = new XMLHttpRequest();
            xhr.open('GET', '/send_command/' + command, true);
            xhr.send();
        }

        manualBtn.addEventListener('click', () => {
            manualBtn.classList.add('active');
            autoBtn.classList.remove('active');
            fetch('/set_mode', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ mode: 'manual' })
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));
        });

        autoBtn.addEventListener('click', () => {
            autoBtn.classList.add('active');
            manualBtn.classList.remove('active');
            fetch('/set_mode', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ mode: 'auto' })
            })
            .then(response => response.json())
            .then(data => console.log(data))
            .catch(error => console.error('Error:', error));
        });

        setInterval(() => {
            fetch('/get_gps')
                .then(response => response.json())
                .then(data => gpsCoordinates.textContent = data.gps)
                .catch(error => console.error('Error:', error));

            fetch('/get_infected_data')
                .then(response => response.json())
                .then(data => {
                    infectedCount.textContent = `${data.infected} plants`;
                    blackpodCount.textContent = `${data.blackpod} plants`;
                    frostypodCount.textContent = `${data.frostypod} plants`;
                    miridCount.textContent = `${data.mirid} plants`;
                })
                .catch(error => console.error('Error:', error));
        }, 1000);     

        // Switching between Manual and Auto Mode
        manualBtn.addEventListener('click', () => {
            manualBtn.classList.add('active');
            autoBtn.classList.remove('active');
            manualControls.style.display = 'flex';
            autoControls.style.display = 'none';
        });

        autoBtn.addEventListener('click', () => {
            autoBtn.classList.add('active');
            manualBtn.classList.remove('active');
            manualControls.style.display = 'none';
            autoControls.style.display = 'flex';
        });

        // Function to add new waypoint
        function addWaypoint() {
            const newWaypoint = newWaypointInput.value;
            if (newWaypoint) {
                const listItem = document.createElement('p');
                listItem.textContent = newWaypoint;
                waypointList.appendChild(listItem);
                newWaypointInput.value = '';  // Clear the input after adding
            }
        }
    </script>
</body>
</html>
